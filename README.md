# Проект сайта на 1С-Битрикс: Управление сайтом
Сделан на демонстрационной версии 1С-Битрикс: Управление сайтом
в комплектации "Малый бизнес".

[Ссылка на загрузку демоверсии (раздел "Дистрибутивы для PHP")](https://www.1c-bitrix.ru/download/cms.php#tab-subsection-3)

---

## Выполнение задания 2

### Статус выполнения

Для задания 2 выполнено:

1. [x] создание веб-формы,
2. [x] создание шаблона компонента form.result.new, интегрированный с формой

### Детали выполнения задания

#### Перенос шаблона сайта в папке /local

Для кастомизации шаблона сайта произведено копирование папки шаблона 
текущего сайта (в тесте это eshop_bootstrap_v4) из папки `/site/bitrix`
в папку `/site/local`.
Сделано в коммите `Prepare n move current site template for customize in /local folder`

Для интеграции шаблона потребовалось модифицировать шапку сайта, код
которой расположен в файле
`/site/local/templates/eshop_bootstrap_v4/header.php`

На страницах, начинающихся с `<domain>/contact-with/`, сделано переключение
класса блока контента для использования всей ширины экрана (это необходимо
для интеграции)

#### Об создании страницы с компонентом form.result.new и кастомизации шаблона

##### В административной части 

В настройках модуля "Веб-формы" (`Настройки -> Настройки продукта -> Настройки модулей -> Веб-формы`)
отключим параметр "Использовать упрощенный режим редактирования форм". 

В административном разделе создаем экземпляр веб-формы
(из модуля Веб-формы, доступного с редакции "Стандарт").

Создаем веб-форму, перейдя по пути `Сервисы -> Веб-формы -> Настройка форм`.

Заданные значения на вкладке "Свойства"

| Название поля                                   | Значение               |
|:------------------------------------------------|:-----------------------|
| Наименование                                    | Связаться              |
| Символьный идентификатор                        | contact\_with          |
| Название ссылки на результаты (Russian)         | Ответы "Связаться"     |
| Название ссылки на результаты (English)         | Answers "Contact with" |
| Подпись на кнопке, сохраняющей результаты формы | Оставить заявку        |

На вкладке "Шаблон" выбрать пункт `Использовать шаблон формы по умолчанию`

Права групп на данную форму оставить по-умолчанию: `Заполнение формы`

После создания формы заполним её вопросы и поставим 1 статус.

Заданные значения вопросов:

*   Текст ответа вопроса во всех вопросах задается в виде одного пробела.

*   На вкладках "Свойства", "Вопрос", "Ответ", "Валидаторы":

| Символьный идентификатор | Обязателен | Вопрос (Заголовок) | Ответ (Тип поля) |
|:-------------------------|:-----------|:-------------------|:-----------------|
| name                     | Да         | Ваше имя           | text             |
| company                  | Да         | Компания/Должность | text             |
| email                    | Да         | Email              | text             |
| phone                    | Да         | Номер телефона     | text             |
| message                  | Нет        | Сообщение          | textarea         |

Указанный символьный код формы далее будет использован в вызове компонента.

##### В публичной части

Для страницы отключаем отображение боковой панели, стандартного заголовка и
заменяем класс элемента-контейнера центральной части страницы.
Делается это в файле `/site/local/templates/eshop_bootstrap_v4/header.php`

Создаем пустую страницу по адресу `/site/contact-with/`

С помощью режима правки установим на ней компонент `form.result.view`

Задаём ИД формы в форме настройки компонента (там будет список с нужной формой).

Копируем шаблон компонента в папку `/site/local/templates/eshop_bootstrap_v4/components/bitrix/`.
Получим папку шаблона такую
`site/local/templates/eshop_bootstrap_v4/components/bitrix/form.result.new/bootstrap_v4`

в ней можно выделить следующие файлы и папки:

* `/images/` - папка изображений (для style.css)
* `/lang/en/template.php` - файл переводов на английский
* `/lang/ru/template.php` - файл переводов на русский
* `/style.css` - файл стилей компонента
* `/template.php` - файл шаблона компонента

Данный файл шаблона компонента кастомизирован для вывода формы по заданию. 

---

## Выполнение задания 1

### Статус выполнения

Для задания 1 выполнено:

1. [x] развертка проекта,
2. [x] подключение composer директории,
3. [x] создание шаблона news.list.

### О запуске проекта (Apache&PHP&MySQL&1С-Битрикс: Управление сайтом&Настройки локального сайта)

#### Окружение проекта

Детали окружения проекта:

* Веб сервер Apache 2.4.58
* PHP версии 8.1.25
* MySQL совместимый сервер MariaDB 10.4.32

#### Перед первым запуском проекта

Включенные PHP параметры в файле php.ini
```ini
short_open_tag=On
log_errors=On
extension=curl
extension=gd
```

В файле `./site/bitrix/php_interface/after_connect_d7.php` внесены
рекомендации по параметрам соединения к БД
```php
<?php
$this->queryExecute("SET sql_mode=''");
$this->queryExecute("SET NAMES 'utf8mb4'");
$this->queryExecute("SET collation_connection = 'utf8mb4_unicode_ci'");
```

Для проекта создан VirtualHost из настроек Apache, пример приложен ниже:
```apacheconf
<VirtualHost *:80>
    ServerAdmin webmaster@lbs.btr
    DocumentRoot "C:/root/app/xampp8125/htdocs/lbs.btr/site"
    ServerName lbs.btr
    ErrorLog "logs/lbs.btr-error.log"
    CustomLog "logs/lbs.btr-access.log" common
</VirtualHost>
```

На тестовой машине настроен dns сопоставление ip-domain, ниже пример записи в Windows hosts файл
```ini
127.0.0.1 lbs.btr
```

Для инсталляции сайта использовано тестовое доменное имя `lbs.btr` (без использования реального домена), название сайта `LBS BTRX+`, URL сервера (без http://): `lbs.btr`

#### После первого запуска проекта и прохождения инсталляции через веб-интерфейс

При развертке проекта на компьютере (хост-системе) доступны алиасы для
`php` и `composer`, чтобы выполнять подключение библиотек сайта.
Подключение composer к сайту выполнялось по инструкции с сайта портала
разработчиков 1С-Битрикс, [её ссылка: https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=4637](https://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=4637)

При успешном конфигурировании 1С-Битрикс и внешнего composer.json
добавлен следующий код в файл `./site/bitrix/php_interface/init.php`
```php
<?php

$fn_get_composer_path = function () {
    $composer_path = $_SERVER["DOCUMENT_ROOT"] . '/../bx_my_composer/vendor/autoload.php';
    $is_ok = file_exists($composer_path);
    if(!$is_ok) {
        return null;
    }
    return realpath($composer_path);
};
// если путь есть, то подключаем
if (($composer_path = $fn_get_composer_path()) !== null) {
    require_once($composer_path);
}
```

### Об создании и кастомизации шаблона компонента news.list

Для хранения измененных шаблонов создана папка `/local` (в папке `/site`)

На тестовом сайте используется шаблон `Адаптивный шаблон интернет-магазина`,
его ид=`eshop_bootstrap_v4`

В данном случае по умолчанию шаблоном компонента `news.list` является
шаблон `bootstrap_v4`.

Войдя в аккаунт администратора можно скопировать шаблон в один из существующих шаблонов сайта. В данном случае шаблон (`bootstrap_v4`) скопирован в шаблон `.default`

Получен путь до шаблона компонента такой: `/site/local/templates/.default/components/bitrix/news.list/`

Содержимое папки шаблона (<news.list> - это путь до папки компонента):
* `<news.list>/bootstrap_v4/images/` - папка до картинок компонента
* `<news.list>/bootstrap_v4/lang/` - папка до языковых параметров (переводов) компонента
* `<news.list>/bootstrap_v4/.parameters.php` - получение данных для шаблона (получение списка новостей из инфоблока и других параметров)
* `<news.list>/bootstrap_v4/.result_modifier.php` - подготовка уже полученных данных для шаблона (уточнение параметров элементов списка новостей из инфоблока и других параметров)
* `<news.list>/bootstrap_v4/script.js` - JavaScript функции для дополнительного функционала на стороне клиента
* `<news.list>/bootstrap_v4/style.css` - Стилизация компонента
* `<news.list>/bootstrap_v4/template.php` - Файл шаблона компонента. Данные проходят такой путь: `.parameters.php -> .result_modifier.php -> template.php`


---

..
